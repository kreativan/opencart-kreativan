<?xml version="1.0" encoding="utf-8"?>
<modification>
<name>Modification Default</name>
<code>default</code>
<version>1.1</version>
<author>OpenCart Ltd</author>
<link>http://www.opencart.com</link>

<file path="system/{engine,library}/{action,loader,config,language}*.php|system/library/template/template.php">
  <operation>
    <search regex="true">
      <![CDATA[~(require|include)(_once)?\(([^)]+)~]]>
    </search>
    <add position="replace">
      <![CDATA[$1$2(modification($3)]]>
    </add>
  </operation>
</file>

<!-- add kreativan menu on sidebar -->
<file path="admin/controller/common/column_left.php">
  <operation>
    <search><![CDATA[ $catalog = array(); ]]></search>
      <add position="before"><![CDATA[
          $kreativan = array();
          // Items
          $kreativan[] = array(
            'name'	   => 'Settings',
            'href'     => $this->url->link('kreativan/settings', 'user_token=' . $this->session->data['user_token'], true),
            'children' => array()
          );
          $kreativan[] = array(
            'name'	   => 'Theme',
            'href'     => $this->url->link('extension/theme/kreativan', 'user_token=' . $this->session->data['user_token'] . '&store_id=0', true),
            'children' => array()
          );
          $kreativan[] = array(
            'name'	   => 'Homepage Layout',
            'href'     => $this->url->link('design/layout/edit', 'user_token=' . $this->session->data['user_token'] . '&layout_id=1', true),
            'children' => array()
          );
          $kreativan_module_db = $this->db->query("SELECT * FROM `" . DB_PREFIX . "module` WHERE `code` = 'kreativan' ORDER BY `name`");
          if($kreativan_module_db->num_rows > 0) {
            $kreativan_module_id = $kreativan_module_db->row['module_id'];
            $kreativan[] = array(
              'name'	   => 'Custom Module',
              'href'     => $this->url->link('extension/module/kreativan', 'user_token=' . $this->session->data['user_token'] . '&module_id=' . $kreativan_module_id, true),
              'children' => array()
            );
          }
          $kreativan[] = array(
            'name'	   => 'Modules',
            'href'     => $this->url->link('marketplace/extension', 'user_token=' . $this->session->data['user_token'] . '&type=module', true),
            'children' => array()
          );
          $data['menus'][] = array(
            'id'       => 'kreativan-menu',
            'icon'	   => 'fa-html5',
            'name'	   => 'Kreativan',
            'href'     => '',
            'children' => $kreativan
          );
      ]]>
    </add>
  </operation>
</file>

<!-- header controller -->
<file path="catalog/controller/common/header.php">
  <operation>
    <search><![CDATA[ return $this->load->view('common/header', $data); ]]></search>
    <add position="before"><![CDATA[
        $data['theme'] = $this->config->get('config_theme');
        $data['headerbar'] = $this->load->controller('kreativan/headerbar');
        $data['navbar'] = $this->load->controller('kreativan/navbar');
        $data['less'] = $this->load->controller('kreativan/less');
      ]]>
    </add>
  </operation>
</file>

<!-- footer controller -->
<file path="catalog/controller/common/footer.php">
  <operation>
    <search><![CDATA[ return $this->load->view('common/footer', $data); ]]></search>
    <add position="before"><![CDATA[
        $data['cart'] = $this->load->controller('common/cart');
        $data['offcanvas_menu'] = $this->load->controller('kreativan/offcanvas_menu');
      ]]>
    </add>
  </operation>
</file>

<!-- home controller -->
<file path="catalog/controller/common/home.php">
  <operation>
    <search><![CDATA[ $this->response->setOutput($this->load->view('common/home', $data)); ]]></search>
    <add position="before"><![CDATA[
        $data['hero'] = $this->load->controller('kreativan/hero');
      ]]>
    </add>
  </operation>
</file>

<!-- product controller -->
<file path="catalog/controller/product/product.php">
  <!-- add controlers -->
  <operation>
    <search><![CDATA[ $this->response->setOutput($this->load->view('product/product', $data)); ]]></search>
    <add position="before"><![CDATA[
        $data['product_related'] = $this->load->controller('kreativan/product_related');
        $data['product_options'] = $this->load->controller('kreativan/product_options');
        $data['product_media'] = $this->load->controller('kreativan/product_media');
        $data['product_review_form'] = $this->load->controller('kreativan/product_review_form');
        $data['product_attributes'] = $this->load->controller('kreativan/product_attributes');
        $data['product_reviews'] = $this->load->controller('kreativan/product_reviews');
      ]]>
    </add>
  </operation>
  <!-- add custom scripts -->
  <operation>
    <search><![CDATA[ public function index() { ]]></search>
    <add position="after"><![CDATA[
        $lang_code = $this->language->get('code');
        $theme_dir = "catalog/view/theme/" . $this->config->get('config_theme') . "/";
        $this->document->addStyle("{$theme_dir}vendor/flatpickr/flatpickr.min.css");
        $this->document->addScript("{$theme_dir}vendor/flatpickr/flatpickr.min.js");
        if($lang_code != "en") {
          $this->document->addScript("{$theme_dir}vendor/flatpickr/l10n/{$lang_code}.js");
        }
      ]]>
    </add>
  </operation>
  <!-- disable loading defailt oc css/js -->
  <operation>
    <search><![CDATA[ $this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js'); ]]></search>
    <add position="before"><![CDATA[ /* ]]></add>
  </operation>
  <operation>
    <search><![CDATA[ $this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css'); ]]></search>
    <add position="after"><![CDATA[ */ ]]></add>
  </operation>
</file>

<!-- compare -->
<file path="catalog/controller/product/compare.php">
  <operation>
    <search><![CDATA[ $this->response->addHeader('Content-Type: application/json'); ]]></search>
    <add position="before"><![CDATA[
        $json["count"] = isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0;
      ]]>
    </add>
  </operation>
</file>

<!-- checkout / cart -->
<file path="catalog/controller/checkout/cart.php">
  <operation>
    <search><![CDATA[ $this->response->addHeader('Content-Type: application/json'); ]]></search>
    <add position="before"><![CDATA[
        $count = $this->cart->countProducts();
        $json["count"] = (int) $count;
      ]]>
    </add>
  </operation>
</file>

<!-- account / wishlist -->
<file path="catalog/controller/account/wishlist.php">
  <operation>
    <search><![CDATA[ $this->response->addHeader('Content-Type: application/json'); ]]></search>
    <add position="before"><![CDATA[
        $json["count"] = isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0;
      ]]>
    </add>
  </operation>
</file>

<!-- manufacturer -->
<file path="catalog/controller/product/manufacturer.php">
  <operation>
    <search><![CDATA[ $data['categories'][$key]['manufacturer'][] = array( ]]></search>
    <add position="before"><![CDATA[
         $this->load->model('tool/image');
      ]]>
    </add>
  </operation>
  <operation>
    <search><![CDATA[ $data['categories'][$key]['manufacturer'][] = array( ]]></search>
    <add position="after"><![CDATA[
        "image" => $this->model_tool_image->resize($result["image"], 80, 80),
      ]]>
    </add>
  </operation>
</file>


<!-- product controller -->
<file path="catalog/controller/affiliate/register.php">
  <operation>
    <search><![CDATA[ public function index() { ]]></search>
    <add position="after"><![CDATA[
        $lang_code = $this->language->get('code');
        $theme_dir = "catalog/view/theme/" . $this->config->get('config_theme') . "/";
        $this->document->addStyle("{$theme_dir}vendor/flatpickr/flatpickr.min.css");
        $this->document->addScript("{$theme_dir}vendor/flatpickr/flatpickr.min.js");
        if($lang_code != "en") {
          $this->document->addScript("{$theme_dir}vendor/flatpickr/l10n/{$lang_code}.js");
        }
      ]]>
    </add>
  </operation>
   <!-- disable loading defailt oc css/js -->
  <operation>
    <search><![CDATA[ $this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js'); ]]></search>
    <add position="before"><![CDATA[ /* ]]></add>
  </operation>
  <operation>
    <search><![CDATA[ $this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css'); ]]></search>
    <add position="after"><![CDATA[ */ ]]></add>
  </operation>
</file>
</modification>